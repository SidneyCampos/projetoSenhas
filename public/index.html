<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Painel CREOI</title>
    <style>
        /* --- RESET --- */
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: #dcdcdc;
            font-family: Arial, Helvetica, sans-serif;
            overflow: hidden;
        }

        /* --- ESTRUTURA MESTRE (Tabela Gigante) --- */
        #layout-mestre {
            display: table;
            width: 100%;
            height: 100%;
            border-collapse: collapse;
        }

        /* Linhas da Tabela Mestre */
        .linha-topo {
            display: table-row;
            height: 15%;
            background: #2b2b2b;
            color: #f0f0f0;
        }

        .linha-meio {
            display: table-row;
            height: 70%;
        }

        .linha-base {
            display: table-row;
            height: 15%;
            background: #2b2b2b;
            color: white;
            border-top: 4px solid #0056b3;
        }

        /* --- CONTEÚDO DO TOPO --- */
        .header-wrap {
            display: table-cell;
            vertical-align: middle;
            border-bottom: 4px solid #0056b3;
            padding: 0 30px;
        }

        .header-table {
            display: table;
            width: 100%;
        }

        .h-left {
            display: table-cell;
            text-align: left;
            vertical-align: middle;
        }

        .h-right {
            display: table-cell;
            text-align: right;
            vertical-align: middle;
        }

        h1 {
            margin: 0;
            font-size: 5vh;
            line-height: 1;
            font-weight: bold;
        }

        p {
            margin: 5px 0 0 0;
            font-size: 2.2vh;
            opacity: 0.9;
        }

        .relogio {
            display: inline-block;
            font-size: 4vh;
            font-weight: bold;
            background: #1a1a1a;
            color: #00bcd4;
            padding: 5px 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        /* --- CONTEÚDO DO MEIO (SENHAS) --- */
        .meio-wrap {
            display: table-cell;
            vertical-align: middle;
            padding: 15px;
        }

        /* Tabela interna */
        .layout-interno {
            display: table;
            width: 100%;
            height: 100%;
            border-spacing: 15px;
            table-layout: fixed;
        }

        /* Coluna Esquerda (Senha) */
        .col-senha {
            display: table-cell;
            width: 65%;
            background: white;
            border: 1px solid #ccc;
            border-radius: 15px;
            vertical-align: middle;
            text-align: center;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            height: 100%;
        }

        .titulo-senha {
            font-size: 6vh;
            color: #555;
            text-transform: uppercase;
            display: block;
            margin-bottom: 0;
            line-height: 1;
        }

        .numero-gigante {
            font-size: 32vh;
            font-weight: bold;
            color: #222;
            display: block;
            line-height: 1;
            margin-top: 0;
        }

        /* Coluna Direita (Histórico) */
        .col-hist {
            display: table-cell;
            width: 35%;
            background: #e8e8e8;
            border: 1px solid #bbb;
            border-radius: 15px;
            vertical-align: top;
            padding: 15px;
            height: 100%;
        }

        .titulo-hist {
            display: block;
            text-align: center;
            font-size: 3vh;
            font-weight: bold;
            color: #333;
            border-bottom: 2px solid #999;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .card-hist-item {
            background: white;
            margin-bottom: 1.2vh;
            padding: 0 15px;
            border-radius: 5px;
            height: 9vh;
            line-height: 9vh;
            display: block;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
        }

        .hist-num {
            font-size: 4.5vh;
            font-weight: bold;
            color: #0056b3;
            float: left;
        }

        .hist-hora {
            font-size: 2.5vh;
            color: #666;
            float: right;
        }

        /* --- CONTEÚDO DA BASE (MENSAGENS) --- */
        .base-wrap {
            display: table-cell;
            vertical-align: middle;
            /* Centraliza o conteúdo na célula */
            text-align: center;
            height: 100%;
        }

        /* CORREÇÃO DO ALINHAMENTO AQUI */

        /* 1. O texto agora é inline-block e alinhado ao meio */
        #msg-texto {
            display: inline-block;
            vertical-align: middle;
            /* Alinha com o ícone */
            font-size: 4.2vh;
            color: white;
            font-weight: bold;
            letter-spacing: 0.5px;
            line-height: 1;
            /* Remove espaçamento extra da fonte */
        }

        /* 2. O Ícone também alinhado ao meio */
        .olho-css {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: white;
            border-radius: 50%;
            position: relative;
            vertical-align: middle;
            /* Alinha com o texto */
            margin-right: 15px;
            border: 4px solid #00bcd4;
            margin-top: -4px;
            /* Pequeno ajuste fino visual para subir 4px */
        }

        .olho-css:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: #2b2b2b;
            border-radius: 50%;
        }

        /* --- TELA BLOQUEIO --- */
        #bloqueio-som {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #2b2b2b;
            z-index: 9999;
            text-align: center;
        }

        #btn-start {
            margin-top: 20%;
            background-color: #0056b3;
            color: white;
            font-size: 4vh;
            padding: 20px 50px;
            border: 2px solid white;
            border-radius: 10px;
            cursor: pointer;
        }

        #btn-start:focus {
            background-color: #00bcd4;
            border-color: yellow;
        }
    </style>
</head>

<body>

    <!-- BLOQUEIO -->
    <div id="bloqueio-som">
        <br><br>
        <h1 style="color: white">CREOI - Painel</h1><br>
        <button id="btn-start" onclick="iniciarSistema()">PRESSIONE ENTER</button>
        <p style="color: #ccc; margin-top: 20px;">Use o controle remoto</p>
    </div>

    <audio id="som-chamada" src="ding.mp3"></audio>

    <!-- TABELA MESTRE -->
    <div id="layout-mestre">

        <!-- LINHA 1: TOPO -->
        <div class="linha-topo">
            <div class="header-wrap">
                <div class="header-table">
                    <div class="h-left">
                        <h1>CREOI</h1>
                        <p>Centro de Referência em Oftalmologia de Iguatama</p>
                    </div>
                    <div class="h-right">
                        <div class="relogio" id="relogio">--:--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LINHA 2: MEIO -->
        <div class="linha-meio">
            <div class="meio-wrap">
                <div class="layout-interno">
                    <div class="col-senha">
                        <span class="titulo-senha">SENHA</span>
                        <span id="display-atual" class="numero-gigante">000</span>
                    </div>
                    <div class="col-hist">
                        <span class="titulo-hist">Anteriores</span>
                        <div id="lista-historico"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LINHA 3: BASE -->
        <div class="linha-base">
            <div class="base-wrap">
                <span class="olho-css"></span>
                <span id="msg-texto">Bem-vindo ao CREOI</span>
            </div>
        </div>

    </div>

    <script>
        var mensagens = [
            // --- BLOCO 1: Catarata e Cuidados Gerais ---
            "A Cirurgia de Catarata recupera a nitidez da sua visão. Consulte-nos.",
            "Realizamos as modernas cirurgias de Catarata 01, 02 e 03.",
            "Visão embaçada ou cores desbotadas podem ser sinais de Catarata.",
            "Proteja seus olhos da radiação UV. Use óculos de sol de qualidade.",
            "Mantenha seus exames em dia. A saúde dos olhos é essencial.",
            "Aguarde ser chamado pelo painel ou pela enfermeira.",

            // --- BLOCO 2: Pterígio (Carne Crescida) ---
            "Realizamos Cirurgia de Pterígio (carne nos olhos) com técnica avançada.",
            "Opção de Cirurgia de Pterígio com cola biológica para melhor recuperação.",
            "Sente areia nos olhos? Pode ser olho seco ou Pterígio. Agende uma avaliação.",
            "Evite coçar os olhos. Isso pode deformar a córnea e causar infecções.",
            "Ao usar computador ou celular, faça pausas a cada 20 minutos.",
            "Aguarde ser chamado pelo painel ou pela enfermeira.",

            // --- BLOCO 3: Plástica Ocular e Pálpebras ---
            "Realizamos Blefaroplastia Superior e Inferior. Estética e função para seu olhar.",
            "Pálpebras caídas? A correção de Ptose melhora seu campo de visão.",
            "Tratamento cirúrgico para Ectrópio e Entrópio (pálpebras viradas).",
            "Realizamos correção de Triquíase (cílios virados para dentro).",
            "Beba água. A hidratação do corpo é fundamental para a produção de lágrimas.",
            "Aguarde ser chamado pelo painel ou pela enfermeira.",

            // --- BLOCO 4: Glaucoma e Pressão Ocular ---
            "O Glaucoma é silencioso. O exame de Curva de Pressão é vital para o diagnóstico.",
            "Realizamos a Cirurgia de Glaucoma. O controle preserva sua visão.",
            "Gonioscopia e Paquimetria: exames essenciais que realizamos aqui.",
            "Histórico de Glaucoma na família? Faça exames anuais obrigatoriamente.",
            "Colírios devem ser usados apenas com prescrição médica.",
            "Aguarde ser chamado pelo painel ou pela enfermeira.",

            // --- BLOCO 5: Retina e Exames de Fundo de Olho ---
            "Realizamos Mapeamento de Retina e Retinografia.",
            "Diabéticos devem fazer o exame de fundo de olho anualmente.",
            "Realizamos o procedimento com Avastin para tratamento da retina.",
            "Manchas escuras na visão? Procure o oftalmologista imediatamente.",
            "Uma boa alimentação rica em vitaminas ajuda a proteger sua retina.",
            "Aguarde ser chamado pelo painel ou pela enfermeira.",

            // --- BLOCO 6: Lentes, Lacrimal e Pequenas Cirurgias ---
            "Adaptação de Lentes de Contato com especialista (Dr. Eduardo).",
            "Olhos lacrimejando muito? Realizamos sondagem das vias lacrimais.",
            "Realizamos a remoção de Calázio, Papiloma e pequenas lesões.",
            "Exerese de pequenas lesões e tumores com segurança.",
            "Faça seu exame de Risco Cirúrgico Oftalmológico conosco.",
            "Aguarde ser chamado pelo painel ou pela enfermeira.",

            // --- BLOCO 7: Exames Específicos e Dicas Finais ---
            "Topografia de Córnea: tecnologia para diagnósticos precisos.",
            "Realizamos o exame de Campo Visual Computadorizado (C.V.C).",
            "Não durma de maquiagem. Isso evita inflamações nas pálpebras.",
            "Lave os cílios durante o banho com shampoo neutro para evitar blefarite.",
            "CREOI - Centro de Referência em Oftalmologia de Iguatama.",
            "Aguarde ser chamado pelo painel ou pela enfermeira."
        ];
        var tempoTroca = 15000;
        var msgIndex = 0;
        var ultimoTimestamp = 0;

        function formatarSenha(num) {
            var s = "000" + num;
            return s.substr(s.length - 3);
        }

        function iniciarSistema() {
            var audio = document.getElementById('som-chamada');
            try { audio.play(); setTimeout(function () { audio.pause(); audio.currentTime = 0; }, 100); } catch (e) { }
            document.getElementById('bloqueio-som').style.display = 'none';

            setInterval(buscarDadosVelho, 1000);
            setInterval(atualizarRelogio, 1000);
            setInterval(rotacionarMensagens, tempoTroca);
            rotacionarMensagens();
        }

        function rotacionarMensagens() {
            var el = document.getElementById('msg-texto');
            el.innerText = mensagens[msgIndex];
            msgIndex++;
            if (msgIndex >= mensagens.length) msgIndex = 0;
        }

        function buscarDadosVelho() {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/api/status", true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var dados = JSON.parse(xhr.responseText);
                    atualizarTela(dados);
                }
            };
            xhr.send();
        }

        function atualizarTela(dados) {
            document.getElementById('display-atual').innerText = formatarSenha(dados.numeroAtual);
            var lista = document.getElementById('lista-historico');
            lista.innerHTML = '';

            var maxItens = 5;
            var total = dados.historico.length;
            if (total > maxItens) total = maxItens;

            for (var i = 0; i < total; i++) {
                var item = dados.historico[i];
                var div = document.createElement('div');
                div.className = 'card-hist-item';
                div.innerHTML = '<span class="hist-num">' + formatarSenha(item.numero) + '</span>' +
                    '<span class="hist-hora">' + item.hora + '</span>';
                lista.appendChild(div);
            }

            if (dados.timestamp > ultimoTimestamp) {
                if (ultimoTimestamp !== 0) {
                    var audio = document.getElementById('som-chamada');
                    audio.currentTime = 0;
                    audio.play();
                }
                ultimoTimestamp = dados.timestamp;
            }
        }

        function atualizarRelogio() {
            var agora = new Date();
            var h = agora.getHours();
            var m = agora.getMinutes();
            if (h < 10) h = "0" + h;
            if (m < 10) m = "0" + m;
            document.getElementById('relogio').innerText = h + ":" + m;
        }

        window.onload = function () {
            var btn = document.getElementById('btn-start');
            if (btn) btn.focus();
        }
    </script>
</body>

</html>